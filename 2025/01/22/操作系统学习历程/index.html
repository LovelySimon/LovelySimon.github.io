<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>操作系统学习历程 | 哥们废了</title>
  <meta name="author" content="Simon An">
  
  <meta name="description" content="记录在NJUST学习和生活历程">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="操作系统学习历程"/>
  <meta property="og:site_name" content="哥们废了"/>

  
    <meta property="og:image" content=""/>
  

  
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<meta name="generator" content="Hexo 7.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">哥们废了</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> 操作系统学习历程</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="操作系统概述"><a href="#操作系统概述" class="headerlink" title="操作系统概述"></a>操作系统概述</h1><h2 id="什么是操作系统"><a href="#什么是操作系统" class="headerlink" title="什么是操作系统"></a>什么是操作系统</h2><p>计算机硬件：极简的公理系统（导线，逻辑门，时钟，触发器）就能够支持非常复杂的数字系统设计</p>
<p>硬件和软件的中间层，需要了解全部但不要细究全部</p>
<ul>
<li>对单机作出抽象</li>
<li>支撑多个程序执行</li>
</ul>
<h2 id="从应用角度看操作系统"><a href="#从应用角度看操作系统" class="headerlink" title="从应用角度看操作系统"></a>从应用角度看操作系统</h2><p><img src="https://simonpic-1330571413.cos.ap-nanjing.myqcloud.com/picblog/image-20250117155511892.png" alt="image-20250117155511892"></p>
<p><img src="https://simonpic-1330571413.cos.ap-nanjing.myqcloud.com/picblog/image-20250117164939996.png" alt="image-20250117164939996"></p>
<p>可以对如图所示的文件进行gcc的编译得到想要的exe可执行文件，也可以使用gcc -c来先进行编译得到.o文件在进行链接</p>
<p><img src="https://simonpic-1330571413.cos.ap-nanjing.myqcloud.com/picblog/image-20250117165106573.png" alt="image-20250117165106573"></p>
<p><strong>在计算机中，我们所有的指令都是计算和move指令，并没有关闭程序和关闭计算机的指令，那么这个过程是谁在发挥作用？</strong></p>
<p>答案是操作系统。</p>
<p>借助操作系统来实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movq $SYS_exit , %rax #exit(</span><br><span class="line">movq $1,         %rdi # status=1</span><br><span class="line">syscall               #);</span><br></pre></td></tr></table></figure>

<ul>
<li>将系统调用的参数放到寄存器中</li>
<li>执行sys call，操作系统接管程序，操作系统可以任意改变程序状态（甚至终止程序）</li>
</ul>
<p><strong>应用程序&#x3D;计算+操作系统API</strong></p>
<p>举例说明：</p>
<ul>
<li><p>窗口管理器：能直接管理屏幕设备</p>
<p>​			能够和其他进程通信</p>
</li>
<li><p>任务管理器：能访问操作系统提供的进程对象</p>
</li>
<li><p>杀毒软件：文件静态扫描（read），主动防御（ptrace）</p>
</li>
</ul>
<p><strong>操作系统的职责：提供令应用程序舒适的抽象（对象+API）</strong></p>
<h3 id="理解高级语言程序"><a href="#理解高级语言程序" class="headerlink" title="理解高级语言程序"></a>理解高级语言程序</h3><ul>
<li><p>C语言代码经过编译之后得到二进制文件，执行二进制文件就可以依次执行指令，每次执行一条“语句”</p>
</li>
<li><p>在使用gdb调试代码的时候可以发现，c语言文件的执行也是一种状态机，那我们可以试着使用c语言的源代码来模拟状态机的运行，也就是将代码写成<strong>“simpleC”</strong></p>
</li>
</ul>
<p><strong>状态机是拥有严格数学定义的对象，这意味着可以用定义的方式写出来</strong></p>
<ul>
<li>状态就是各种栈帧和全局变量的组合。</li>
<li>初始状态下仅有一个栈帧（main函数栈帧），且全局变量均为初始值（PC&#x3D;0）</li>
<li>状态迁移：执行栈帧PC</li>
</ul>
<p>试图把c代码改写成simpleC：</p>
<ul>
<li>每一条语句至多一次运算</li>
<li>条件语句中不包含运算</li>
</ul>
<h3 id="编译器与编译优化"><a href="#编译器与编译优化" class="headerlink" title="编译器与编译优化"></a>编译器与编译优化</h3><ul>
<li>编译器的输入：高级c语言代码</li>
<li>编译器的输出：汇编代码（指令序列）</li>
<li>编译器就是状态机之间的翻译器</li>
</ul>
<p><strong>simpleC翻译</strong>：</p>
<ul>
<li>运算：把操作数load到寄存器，执行运算，store写回结果</li>
<li>分支&#x2F;循环：使用条件跳转分别执行代码</li>
<li>函数调用：专门留一个寄存器给栈（SP，stackPointer），将stackframe的信息保存到内存中</li>
</ul>
<p><strong>编译优化三板斧</strong>：</p>
<ul>
<li>函数内联： 将函数调用替换为函数体本身的内容</li>
<li>常量传播：在编译时计算常量表达式的值并替换</li>
<li>死代码消除：删除永远不会执行到的代码</li>
</ul>
<p><strong>那么给定两个程序A和B，编译器到底允不允许把A编译成B？</strong></p>
<ul>
<li>首先要看在syscall调用后两个程序的输出序列是否一致，如果一致则可以编译。</li>
<li>系统调用是使程序计算结果可见的唯一方法，不改变语义&#x3D;不改变可见结果，即如果两个状态机生成的所有syscall序列是完全一致的，则该优化就是允许的。</li>
</ul>
<p><strong>C语言代码中不可优化的部分</strong>：</p>
<ul>
<li><p>External function calls外部函数调用（链接时才能确定到底是什么代码）</p>
<ul>
<li>未知的代码可能包含系统调用</li>
<li>因此不可删除，移除循环等，且要保证参数传递完全一致</li>
</ul>
</li>
<li><p>编译器提供的不可优化标注</p>
</li>
</ul>
<h2 id="从硬件视角理解操作系统"><a href="#从硬件视角理解操作系统" class="headerlink" title="从硬件视角理解操作系统"></a>从硬件视角理解操作系统</h2><h3 id="计算机系统的状态机模型"><a href="#计算机系统的状态机模型" class="headerlink" title="计算机系统的状态机模型"></a>计算机系统的状态机模型</h3><ul>
<li>状态：内存，寄存器的数值</li>
</ul>
<p>​	寄存器，内存</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CPUstate</span>&#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> regs[<span class="number">32</span>],csrs[CSR_COUNT];</span><br><span class="line">    <span class="type">uint8_t</span> *mem;</span><br><span class="line">    <span class="type">uint32_t</span> mem_offset,mem_size;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>​	还有外部世界的态：</p>
<ol>
<li>​	设备上的寄存器</li>
<li>​	中断指令Interrput</li>
<li>​	客观存在但计算机系统不能直接访问，进程只能通过syscall访问外部输入</li>
</ol>
<ul>
<li>初始状态：由系统设计者规定（CPU Reset）</li>
<li>状态迁移：从PC取指令执行</li>
</ul>
<h3 id="计算机系统中的固件"><a href="#计算机系统中的固件" class="headerlink" title="计算机系统中的固件"></a>计算机系统中的固件</h3><p>reset是计算机硬件和系统程序员的第一个接口，如果想要在裸机上面进行编程，只需要做一个电路并在适当的内存放上适当的代码，只要cpu在reset状态，就执行相应的某些代码，此时就可以对cpu进行控制。</p>
<p><strong>什么是固件？</strong></p>
<ul>
<li><p>固件就是厂商在出厂时放置到计算机系统里的代码</p>
<ul>
<li>之所以称之为固件是因为早期时rom，如果想要更新升级则需要换芯片</li>
</ul>
</li>
<li><p>固件的功能：</p>
<ul>
<li>运行程序前的计算机系统配置</li>
<li>CPU电压，内存时序，接口开关等</li>
</ul>
</li>
<li><p>不严格的说，加载操作系统</p>
<ul>
<li>加载存储设备上的引导程序</li>
</ul>
</li>
<li><p>可以成为一个小的操作系统，在CPU reset后初始化硬件，对接操作系统Boot Loader</p>
</li>
<li><p>又称为BIOS(basic io system)</p>
</li>
<li><p>现在有了UEFI(undefined extensible firmware interface)固件提供更丰富的支持如指纹锁蓝牙键盘等</p>
</li>
</ul>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2025/05/22/SegNeXt/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/11/04/算法笔记/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2025-01-22 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/操作系统/">操作系统<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2025 Simon An
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
